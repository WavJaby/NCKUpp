"use strict";import{a as e,button as o,div as n,doomHelperDebug as t,footer as s,h1 as l,h2 as i,h3 as r,img as a,input as c,li as u,mountableStylesheet as d,nav as g,QueryRouter as m,RouterLazyLoad as p,ShowIf as w,Signal as f,span as h,svg as b,text as y,TextState as S,ul as v}from"./res/lib/domHelper_v002.min.js";import{metaSet as C,metaType as k}from"./res/lib/metaTag.js";import{fetchApi as L,isLocalNetwork as I}from"./res/lib/lib.js";import{UserGuideTool as E}from"./res/userGuide.js";window.askForLoginAlert=(()=>window.messageAlert.addInfo("éœ€è¦ç™»å…¥ä¾†ä½¿ç”¨æ­¤é é¢","å³ä¸Šè§’ç™»å…¥æŒ‰éˆ•ç™»å…¥",3e3)),window.loadingElement=b('<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5" stroke-linecap="square"/>',"0 0 50 50","loaderCircle"),window.pageLoading=new f(!1),function(){console.log("index.js Init"),window.messageAlert=new function(){const e=n("messageBox");function o(){s(this)}function t(t,l,i,r,a){const c=n(t,{onclick:o},h(l,"title"),h(i,"description",r),n("closeButton"));void 0!==a&&(c.removeTimeout=setTimeout(()=>s(c),a)),e.childElementCount>0?e.insertBefore(c,e.firstElementChild):e.appendChild(c),c.style.marginTop=-c.offsetHeight+"px",setTimeout(()=>{c.classList.add("animation"),c.style.marginTop="0"},10)}function s(o){clearTimeout(o.removeTimeout),o.style.opacity="0",o.style.marginTop=-o.offsetHeight-10+"px",setTimeout(()=>{e.removeChild(o)},500)}this.element=e,this.addInfo=function(e,o,n){t("info",e,o,null,n)},this.addError=function(e,o,n){t("error",e,o,null,n)},this.addErrorElement=function(e,o,n){t("error",e,null,o,n)},this.addSuccess=function(e,o,n){t("success",e,o,null,n)}},window.requestState=new function(){const e=this.element=n("stateBox noSelect");this.addState=function(o){return e.appendChild(n(null,window.loadingElement.cloneNode(!0),l(o,"title")))},this.removeState=function(o){e.removeChild(o)}};const b=d("https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap");document.requestStorageAccess&&document.requestStorageAccess().then(()=>console.log("StorageAccess granted"),()=>console.log("StorageAccess denied"));const H=new E,T=I||window.localStorage&&!!localStorage.getItem("debug");let j=null;if(T){if(console.log("Debug enabled"),t(),window.performance&&window.performance.memory){const e=new f(window.performance.memory);setInterval(()=>e.set(window.performance.memory),1e3),j=h(S(e,e=>(e.usedJSHeapSize/1e3/1e3).toFixed(2)+"MB"),null,{style:"position: absolute; top: 0; z-index: 100; background: black; font-size: 10px; opacity: 0.5;"})}}else console.log("Debug disable");const A={Home:"æˆåŠŸå¤§å­¸èª²ç¨‹è³‡è¨ŠåŠé¸èª²ç³»çµ±",CourseSearch:"èª²ç¨‹æŸ¥è©¢",Schedule:"èª²è¡¨",GradeInquiry:"æˆç¸¾æŸ¥è©¢",CourseSelectionPreference:"å¿—é¡˜æ’åº",UsefulWebsite:"å¯¦ç”¨ç¶²ç«™",Profile:"ä½¿ç”¨è€…è³‡æ–™"},P=["CourseSearch","Schedule","GradeInquiry","CourseSelectionPreference","UsefulWebsite"],U=new f,_=new f(!1),x=new m("NCKU++",A,"Home",{Home:new p("./res/pages/home_v002.min.js"),CourseSearch:new p("./res/pages/courseSearch.js",U),Schedule:new p("./res/pages/courseSchedule.js",U),GradeInquiry:new p("./res/pages/stuIdSysGrades.js",U),CourseSelectionPreference:new p("./res/pages/preferenceAdjust.js",U),UsefulWebsite:new p("./res/pages/usefulWebsite.js",U),Profile:new p("./res/pages/profile.js",U)},s(n("borderLine"),n("source",i("è³‡æ–™ä¾†æº"),e(null,"https://course.ncku.edu.tw/","noSelect",null,{target:"_blank"},a("res/assets/courseNcku_logo.png","åœ‹ç«‹æˆåŠŸå¤§å­¸èª²ç¨‹è³‡è¨ŠåŠé¸èª²ç³»çµ±","noDrag")),e(null,"https://nckuhub.com/","noSelect",null,{target:"_blank"},a("res/assets/nckuHub_logo.svg","NCKUHub","noDrag")),e(null,"https://urschool.org/","noSelect",null,{target:"_blank"},a("res/assets/UrSchool_logo.png","UrSchool","noDrag")),n("splitLine")),r("By WavJaby"),r("Email: WavJaby@gmail.com"),e(null,"https://github.com/WavJaby/NCKUpp","openRepo noSelect",null,{target:"_blank"},a("./res/assets/github_icon.svg","GitHub icon","githubIcon noDrag"),h("GitHub repo"))));enableGoogleAnalytics(T);const B={};for(const o of P)B[o]=u(null,e(A[o],"./?page="+o,null,N,{pageId:o}));x.onPageOpen=function(e,o){const n=B[e];e&&n&&n.classList.remove("opened");const t=B[o];t&&t.classList.add("opened"),C(k.TITLE,document.title)};const W=v("links",Object.values(B),u(null,J("arrow",y("0w0"),[["å—¨å—¨",null],["ğŸ¥°",null]]))),D=v("navBarMobileBG",{onclick:G});function G(){W.classList.remove("open"),D.classList.remove("open")}window.navMenuClose=G,L("/login?mode=course","Check login").then(F);const q=n("root",g("navbar noSelect",J("loginBtn",h(S(U,e=>e&&e.login?e.studentID:"Login")),[["Profile",()=>x.openPage("Profile")],["Logout",()=>L("/logout").then(F)]],!1,()=>(G(),!(!U.state||!U.state.login)||(_.set(!_.state),!1))),v("hamburgerMenu",u(null,a("./res/assets/burger_menu_icon.svg","mobile menu button","noDrag noSelect",{onclick:function(){W.classList.toggle("open"),D.classList.toggle("open")}}))),v("homePage",u(null,e("NCKU++","./?page=Home",null,N,{pageId:"Home"}))),D,W),x.element,H.element,w(_,function(e){const t=c("loginField","Account",null,{onkeyup:i,type:"email",autocomplete:"username"}),s=c("loginField","Password",null,{onkeyup:i,type:"password",autocomplete:"current-password"});let l=!1;function i(e){"Enter"===e.key&&r()}function r(){if(!l){l=!0,window.pageLoading.set(!0);const o=t.value.endsWith("@ncku.edu.tw")?t:t.value+"@ncku.edu.tw";L("/login?mode=course","login",{method:"POST",body:`username=${encodeURIComponent(o)}&password=${encodeURIComponent(s.value)}`,timeout:1e4}).then(o=>{l=!1,window.pageLoading.set(!1),e(o)})}}return n("loginWindow",{onRender:()=>t.focus()},h("å¸³å¯†èˆ‡æˆåŠŸå…¥å£ç›¸åŒ","description"),t,s,o("loginField","Login",r,{type:"submit"}))}(F)),w(window.pageLoading,n("loading",window.loadingElement.cloneNode(!0))),window.messageAlert.element,window.requestState.element,j);function N(e){e.preventDefault();const o=this.pageId;return x.openPage(o),G(),!1}function F(e){if(!e)return void window.messageAlert.addError("Network error","Try again later",3e3);const o=e.data;o?o.login||!e.msg?(U.set(o),_.set(!1)):window.messageAlert.addError("Login failed",e.msg,5e3):window.messageAlert.addError("Unknown login error","Try again later",3e3)}function J(e,o,n,t,s){const l=v(null),i=v(e?"list "+e:"list",t?{onmouseleave:a,onmouseenter:r}:null,u("items",l),u("title",o,{onclick:function(){if(s&&!s()&&!i.style.height)return;i.style.height?a():r()}}));for(const e of n){const o=e[1];l.appendChild(u(null,y(e[0]),{onItemClick:o,onclick:a}))}function r(){i.style.height=i.firstElementChild.offsetHeight+i.lastElementChild.offsetHeight+"px",window.addEventListener("pointerup",c)}function a(){this&&this.onItemClick&&this.onItemClick(),i.style.height=null,window.removeEventListener("pointerup",c)}function c(e){let o=e.target;do{if(o===i)return}while((o=o.parentElement)!==document.body);a()}return i}window.onload=(()=>{for(console.log("Window onload"),b.mount(),x.initFirstPage();document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(q)})}();