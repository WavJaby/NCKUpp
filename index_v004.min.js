"use strict";import{a as o,button as i,div as u,doomHelperDebug as n,footer as t,h1 as s,h2 as l,h3 as a,img as r,input as c,li as g,mountableStylesheet as d,nav as m,QueryRouter as W,RouterLazyLoad as p,ShowIf as f,Signal as h,span as w,svg as e,text as b,TextState as y,ul as v}from"./res/domHelper_v001.min.js";import{metaSet as N,metaType as q}from"./res/metaTag.js";import{fetchApi as S}from"./res/lib.js";window.askForLoginAlert=()=>window.messageAlert.addInfo("Login to use this page","Click login button at top right corner to login in",3e3),window.loadingElement=e('<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5" stroke-linecap="square"/>',"0 0 50 50","loaderCircle"),window.pageLoading=new h(!1);{console.log("index.js Init"),window.messageAlert=new function(){const i=u("messageBox");function a(){r(this)}function t(e,o,n,t,s){const l=u(e,{onclick:a},w(o,"title"),w(n,"description",t),u("closeButton"));void 0!==s&&(l.removeTimeout=setTimeout(()=>r(l),s)),0<i.childElementCount?i.insertBefore(l,i.firstElementChild):i.appendChild(l),l.style.marginTop=-l.offsetHeight+"px",setTimeout(()=>{l.classList.add("animation"),l.style.marginTop="0"},10)}function r(e){clearTimeout(e.removeTimeout),e.style.opacity="0",e.style.marginTop=-e.offsetHeight-10+"px",setTimeout(()=>{i.removeChild(e)},500)}this.element=i,this.addInfo=function(e,o,n){t("info",e,o,null,n)},this.addError=function(e,o,n){t("error",e,o,null,n)},this.addErrorElement=function(e,o,n){t("error",e,null,o,n)},this.addSuccess=function(e,o,n){t("success",e,o,null,n)}},window.requestState=function(){const o=u("stateBox noSelect");return o.addState=function(e){return o.appendChild(u(null,window.loadingElement.cloneNode(!0),s(e,"title")))},o.removeState=function(e){o.removeChild(e)},o}();const T=d("https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap");document.requestStorageAccess().then(()=>console.log("StorageAccess granted"),()=>console.log("StorageAccess denied"));let e=null;if("localhost"===location.hostname){if(console.log("Debug enabled"),n(),window.performance&&window.performance.memory){const B=new h(window.performance.memory);setInterval(()=>B.set(window.performance.memory),1e3),e=w(y(B,e=>(e.usedJSHeapSize/1e3/1e3).toFixed(2)+"MB"),null,{style:"position: absolute; top: 0; z-index: 100; background: black; font-size: 10px; opacity: 0.5;"})}}else console.log("Debug disable");var C={Home:"æˆåŠŸå¤§å­¸èª²ç¨‹è³‡è¨ŠåŠé¸èª²ç³»çµ±",CourseSearch:"èª²ç¨‹æŸ¥è©¢",Schedule:"èª²è¡¨",GradeInquiry:"æˆç¸¾æŸ¥è©¢",CourseSelectionPreference:"å¿—é¡˜æŽ’åº",UsefulWebsite:"å¯¦ç”¨ç¶²ç«™",Profile:"ä½¿ç”¨è€…è³‡æ–™"};const H=new h,j=new h(!1),x=new W("NCKU++",C,"Home",{Home:new p("./pages/home_v001.min.js"),CourseSearch:new p("./pages/courseSearch.js",H),Schedule:new p("./pages/courseSchedule.js",H),GradeInquiry:new p("./pages/stuIdSysGrades.js",H),CourseSelectionPreference:new p("./pages/preferenceAdjust.js",H),UsefulWebsite:new p("./pages/usefulWebsite.js",H),Profile:new p("./pages/profile.js",H)},t(u("borderLine"),u("source",l("è³‡æ–™ä¾†æº"),o(null,"https://course.ncku.edu.tw/","noSelect",null,{target:"_blank"},r("res/assets/courseNcku_logo.png","åœ‹ç«‹æˆåŠŸå¤§å­¸èª²ç¨‹è³‡è¨ŠåŠé¸èª²ç³»çµ±","noDrag")),o(null,"https://nckuhub.com/","noSelect",null,{target:"_blank"},r("res/assets/nckuHub_logo.svg","NCKUHub","noDrag")),o(null,"https://urschool.org/","noSelect",null,{target:"_blank"},r("res/assets/UrSchool_logo.png","UrSchool","noDrag")),u("splitLine")),a("By WavJaby"),a("Email: WavJaby@gmail.com"),o(null,"https://github.com/WavJaby/NCKUpp","openRepo noSelect",null,{target:"_blank"},r("./res/assets/github_icon.svg","GitHub icon","githubIcon noDrag"),w("GitHub repo")))),A={};for(const D of["CourseSearch","Schedule","GradeInquiry","CourseSelectionPreference","UsefulWebsite"])A[D]=g(null,o(C[D],"./?page="+D,null,L,{pageId:D}));x.onPageOpen=function(e,o){var n=A[e],e=(e&&n&&n.classList.remove("opened"),A[o]);e&&e.classList.add("opened"),N(q.TITLE,document.title)};const P=v("links",Object.values(A),g(null,E("arrow",b("0w0"),[["å®‰å®‰",null],["ðŸ¥°",null]]))),U=v("navBarMobileBG",{onclick:k});function k(){P.classList.remove("open"),U.classList.remove("open")}window.navMenuClose=k,S("/login?mode=course","Check login").then(I);const _=u("root",m("navbar noSelect",E("loginBtn",w(y(H,e=>e&&e.login?e.studentID:"Login")),[["Profile",()=>x.openPage("Profile")],["Logout",()=>S("/logout").then(I)]],!1,()=>(k(),!(!H.state||!H.state.login)||(j.set(!j.state),!1))),v("hamburgerMenu",g(null,r("./res/assets/burger_menu_icon.svg","mobile menu button","noDrag noSelect",{onclick:function(){P.classList.toggle("open"),U.classList.toggle("open")}}))),v("homePage",g(null,o("NCKU++","./?page=Home",null,L,{pageId:"Home"}))),U,P),x.element,f(j,function(o){const n=c("loginField","Account",null,{onkeyup:e,type:"text"}),t=c("loginField","Password",null,{onkeyup:e,type:"password"});let s=!1;function e(e){"Enter"===e.key&&l()}function l(){var e;s||(s=!0,window.pageLoading.set(!0),e=n.value.endsWith("@ncku.edu.tw")?n:n.value+"@ncku.edu.tw",S("/login?mode=course","login",{method:"POST",body:`username=${encodeURIComponent(e)}&password=`+encodeURIComponent(t.value),timeout:1e4}).then(e=>{s=!1,window.pageLoading.set(!1),o(e)}))}return u("loginWindow",{onRender:()=>n.focus()},w("å¸³å¯†èˆ‡æˆåŠŸå…¥å£ç›¸åŒ","description"),n,t,i("loginField","Login",l,{type:"submit"}))}(I)),f(window.pageLoading,u("loading",window.loadingElement.cloneNode(!0))),window.messageAlert.element,requestState,e);function L(e){e.preventDefault();e=this.pageId;return x.openPage(e),k(),!1}function I(e){var o;e?(o=e.data)?!o.login&&e.msg?window.messageAlert.addError("Login failed",e.msg,5e3):(H.set(o),j.set(!1)):window.messageAlert.addError("Unknown login error","Try again later",3e3):window.messageAlert.addError("Network error","Try again later",3e3)}function E(e,o,n,t,s){var l=v(null);const i=v(e?"list "+e:"list",t?{onmouseleave:u,onmouseenter:r}:null,g("items",l),g("title",o,{onclick:function(){s&&!s()&&!i.style.height||(i.style.height?u:r)()}}));for(const d of n){var a=d[1];l.appendChild(g(null,b(d[0]),{onItemClick:a,onclick:u}))}function r(){i.style.height=i.firstElementChild.offsetHeight+i.lastElementChild.offsetHeight+"px",window.addEventListener("pointerup",c)}function u(){this&&this.onItemClick&&this.onItemClick(),i.style.height=null,window.removeEventListener("pointerup",c)}function c(e){let o=e.target;do{if(o===i)return}while((o=o.parentElement)!==document.body);u()}return i}window.onload=()=>{for(console.log("Window onload"),T.mount();document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(_),x.init()}}