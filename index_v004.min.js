"use strict";import{a as o,button as l,div as u,doomHelperDebug as n,footer as t,h1 as s,h2 as i,h3 as a,img as r,input as c,li as g,mountableStylesheet as d,nav as m,QueryRouter as W,RouterLazyLoad as p,ShowIf as f,Signal as h,span as w,svg as e,text as b,TextState as y,ul as v}from"./res/domHelper_v001.min.js";import{metaSet as N,metaType as G}from"./res/metaTag.js";import{fetchApi as S}from"./res/lib.js";window.askForLoginAlert=()=>window.messageAlert.addInfo("Login to use this page","Click login button at top right corner to login in",3e3),window.loadingElement=e('<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5" stroke-linecap="square"/>',"0 0 50 50","loaderCircle"),window.pageLoading=new h(!1);{console.log("index.js Init"),window.messageAlert=new function(){const l=u("messageBox");function a(){r(this)}function t(e,o,n,t,s){const i=u(e,{onclick:a},w(o,"title"),w(n,"description",t),u("closeButton"));void 0!==s&&(i.removeTimeout=setTimeout(()=>r(i),s)),0<l.childElementCount?l.insertBefore(i,l.firstElementChild):l.appendChild(i),i.style.marginTop=-i.offsetHeight+"px",setTimeout(()=>{i.classList.add("animation"),i.style.marginTop="0"},10)}function r(e){clearTimeout(e.removeTimeout),e.style.opacity="0",e.style.marginTop=-e.offsetHeight-10+"px",setTimeout(()=>{l.removeChild(e)},500)}this.element=l,this.addInfo=function(e,o,n){t("info",e,o,null,n)},this.addError=function(e,o,n){t("error",e,o,null,n)},this.addErrorElement=function(e,o,n){t("error",e,null,o,n)},this.addSuccess=function(e,o,n){t("success",e,o,null,n)}},window.requestState=function(){const o=u("stateBox noSelect");return o.addState=function(e){return o.appendChild(u(null,window.loadingElement.cloneNode(!0),s(e,"title")))},o.removeState=function(e){o.removeChild(e)},o}();const T=d("https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap");let e=null;if("localhost"===location.hostname){if(console.log("Debug enabled"),n(),window.performance&&window.performance.memory){const B=new h(window.performance.memory);setInterval(()=>B.set(window.performance.memory),1e3),e=w(y(B,e=>(e.usedJSHeapSize/1e3/1e3).toFixed(2)+"MB"),null,{style:"position: absolute; top: 0; z-index: 100; background: black; font-size: 10px; opacity: 0.5;"})}}else console.log("Debug disable");var C={Home:"æˆåŠŸå¤§å­¸èª²ç¨‹è³‡è¨ŠåŠé¸èª²ç³»çµ±",CourseSearch:"èª²ç¨‹æŸ¥è©¢",Schedule:"èª²è¡¨",GradeInquiry:"æˆç¸¾æŸ¥è©¢",CourseSelectionPreference:"å¿—é¡˜æŽ’åº",UsefulWebsite:"å¯¦ç”¨ç¶²ç«™",Profile:"ä½¿ç”¨è€…è³‡æ–™"};const H=new h,j=new h(!1),x=new W("NCKU++",C,"Home",{Home:new p("./pages/home_v001.min.js"),CourseSearch:new p("./pages/courseSearch.js",H),Schedule:new p("./pages/courseSchedule.js",H),GradeInquiry:new p("./pages/stuIdSysGrades.js",H),CourseSelectionPreference:new p("./pages/preferenceAdjust.js",H),UsefulWebsite:new p("./pages/usefulWebsite.js",H),Profile:new p("./pages/profile.js",H)},t(u("borderLine"),u("source",i("è³‡æ–™ä¾†æº"),o(null,"https://course.ncku.edu.tw/","noSelect",null,{target:"_blank"},r("res/assets/courseNcku_logo.png","åœ‹ç«‹æˆåŠŸå¤§å­¸èª²ç¨‹è³‡è¨ŠåŠé¸èª²ç³»çµ±","noDrag")),o(null,"https://nckuhub.com/","noSelect",null,{target:"_blank"},r("res/assets/nckuHub_logo.svg","NCKUHub","noDrag")),o(null,"https://urschool.org/","noSelect",null,{target:"_blank"},r("res/assets/UrSchool_logo.png","UrSchool","noDrag")),u("splitLine")),a("By WavJaby"),a("Email: WavJaby@gmail.com"),o(null,"https://github.com/WavJaby/NCKUpp","openRepo noSelect",null,{target:"_blank"},r("./res/assets/github_icon.svg","GitHub icon","githubIcon noDrag"),w("GitHub repo")))),P={};for(const D of["CourseSearch","Schedule","GradeInquiry","CourseSelectionPreference","UsefulWebsite"])P[D]=g(null,o(C[D],"./?page="+D,null,L,{pageId:D}));x.onPageOpen=function(e,o){var n=P[e],e=(e&&n&&n.classList.remove("opened"),P[o]);e&&e.classList.add("opened"),N(G.TITLE,document.title)};const U=v("links",Object.values(P),E("arrow",b("0w0"),[["å®‰å®‰",null],["ðŸ¥°",null]])),_=v("navBarMobileBG",{onclick:k});function k(){U.classList.remove("open"),_.classList.remove("open")}window.navMenuClose=k,S("/login?mode=course","Check login").then(I);const A=u("root",m("navbar noSelect",E("loginBtn",w(y(H,e=>e&&e.login?e.studentID:"Login")),[["Profile",()=>x.openPage("Profile")],["Logout",()=>S("/logout").then(I)]],!1,()=>!(!H.state||!H.state.login)||(j.set(!j.state),!1)),v("hamburgerMenu",g(null,r("./res/assets/burger_menu_icon.svg","mobile menu button","noDrag noSelect",{onclick:function(){U.classList.toggle("open"),_.classList.toggle("open")}}))),v("homePage",g(null,o("NCKU++","./?page=Home",null,L,{pageId:"Home"}))),_,U),x.element,f(j,function(o){const n=c("loginField","Account",null,{onkeyup:e,type:"text"}),t=c("loginField","Password",null,{onkeyup:e,type:"password"});let s=!1;function e(e){"Enter"===e.key&&i()}function i(){var e;s||(s=!0,window.pageLoading.set(!0),e=n.value.endsWith("@ncku.edu.tw")?n:n.value+"@ncku.edu.tw",S("/login?mode=course","login",{method:"POST",body:`username=${encodeURIComponent(e)}&password=`+encodeURIComponent(t.value),timeout:1e4}).then(e=>{s=!1,window.pageLoading.set(!1),o(e)}))}return u("loginWindow",{onRender:()=>n.focus()},w("å¸³å¯†èˆ‡æˆåŠŸå…¥å£ç›¸åŒ","description"),n,t,l("loginField","Login",i,{type:"submit"}))}(I)),f(window.pageLoading,u("loading",window.loadingElement.cloneNode(!0))),window.messageAlert.element,requestState,e);function L(e){e.preventDefault();e=this.pageId;return x.openPage(e),!1}function I(e){var o;e?(o=e.data)?!o.login&&e.msg?window.messageAlert.addError("Login failed",e.msg,5e3):(H.set(o),j.set(!1)):window.messageAlert.addError("Unknown login error","Try again later",3e3):window.messageAlert.addError("Network error","Try again later",3e3)}function E(e,o,n,t,s){var i=v(null);const l=v(e?"list "+e:"list",t?{onmouseleave:u,onmouseenter:r}:null,g("items",i),g("title",o,{onclick:function(){s&&!s()&&!l.style.height||(l.style.height?u:r)()}}));for(const d of n){var a=d[1];i.appendChild(g(null,b(d[0]),{onItemClick:a,onclick:u}))}function r(){l.style.height=l.firstElementChild.offsetHeight+l.lastElementChild.offsetHeight+"px",window.addEventListener("pointerup",c)}function u(){this&&this.onItemClick&&this.onItemClick(),l.style.height=null,window.removeEventListener("pointerup",c)}function c(e){let o=e.target;do{if(o===l)return}while((o=o.parentElement)!==document.body);u()}return l}window.onload=()=>{for(console.log("Window onload"),T.mount();document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(A),x.init()}}